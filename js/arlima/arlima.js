/*! Arlima v3.0.alpha.22 */
function arlimaNestedSortable(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=jQuery.noConflict(),s=a.$elem.find(".articles"),t=2,u=0,v=function(a,b){z(a.placeholder,b,u),u=b},w=function(a){return Math.min(Math.floor(a/30),1)},x=function(a){var b;e=a.placeholder.prev(),f=a.placeholder.next(),e[0]==a.item[0]&&(e=e.prev()),f[0]==a.item[0]&&(f=f.next()),g=e.length?e.offset().top+e.height():0,h=f.length?f.offset().top+f.height()/3:0,c=f.length?y(f):0,d=e.length?(b=y(e)+1)>t?t:b:0},y=function(a){var b=a.eq(0).css("margin-left");return w(b&&-1!=b.indexOf("px")?b.slice(0,-2):0)},z=function(a,b,c){return a.each(function(){var a=r(this);c=c||y(a),r(this).removeClass("list-item-depth-"+c).addClass("list-item-depth-"+b)})},A=function(a,b){return a.each(function(){var a=r(this),c=y(a);r(this).removeClass("list-item-depth-"+c).addClass("list-item-depth-"+(c+b))})},B=function(a){var b=r();return a.each(function(){for(var a=r(this),c=y(a),d=a.next();d.length&&y(d)>c;)b=b.add(d),d=d.next()}),b},C=function(a){return a.closest(".article-list").get(0).arlimaList.data.id},D=function(a){a.get(0).arlimaArticle.listID=C(a)},E=function(){n=!1,m=-1,p=!1},F=function(){a.size()>50&&a.$elem.find(".article:last")[0].arlimaArticle.remove()},G=function(b,c){a.updateParentProperties(),F(),window.ArlimaArticleForm.isEditing(b)&&window.ArlimaArticleForm.setupForm();try{b.effect("highlight",{color:"rgba(255,255,255, .2)"})}catch(d){}c&&a.toggleUnsavedState(!0),a.$elem.trigger("change"),a.$elem.css("z-index",1),a.$elem.siblings().css("z-index",1),b[0].style.top=0,E()};s.sortable({items:".article",placeholder:"sortable-placeholder",connectWith:".article-list:not(.imported) .articles",appendTo:"body",helper:"clone",distance:10,zIndex:9999,over:function(a,b){b.item.hasClass("ui-draggable")||(b.item.data("sortableItem").scrollParent=b.placeholder.parent(),b.item.data("sortableItem").overflowOffset=b.placeholder.parent().offset())},start:function(c,d){if(!d.item.hasClass("ui-draggable")){d.item.data("sortableItem").scrollParent=d.placeholder.parent(),d.item.data("sortableItem").overflowOffset=d.placeholder.parent().offset();var e,f,g,h;j=d.helper.children(".children-transport"),window.arlimaMoveBetweenLists=!1,b=y(d.item),m=d.item.prevAll().length,v(d,b),n=d.item[0].arlimaArticle.isChild(),f=d.item.next()[0]==d.placeholder[0]?d.item.next():d.item,g=B(f),j.append(g),k=g.length>0,q=!(k||"arlimaArticle"in d.item[0]&&!d.item[0].arlimaArticle.canBeChild()),ArlimaUtils.hasMetaKeyPressed(c)||a.data.isImported?(l=!0,o=d.item.clone(!1).show(),a.addArticle(new ArlimaArticle(r.extend(!0,{},d.item.get(0).arlimaArticle.data),null,o),!1),o.insertAfter(d.item).removeClass("editing"),r(g.get().reverse()).each(function(){var b=r(this).clone(!1);a.addArticle(new ArlimaArticle(r.extend(!0,{},this.arlimaArticle.data),null,b),!1),b.insertAfter(o)})):(l=!1,p=window.ArlimaArticlePreview.isPreviewed(d.item[0].arlimaArticle)),e=j.outerHeight(),e+=e>0?1*d.placeholder.css("margin-top").slice(0,-2)+4:0,e+=d.helper.outerHeight(),i=e,e-=2,d.placeholder.height(e),h=d.placeholder.next(),h.css("margin-top",i+"px"),d.placeholder.detach(),r(this).sortable("refresh"),d.item.after(d.placeholder),h.css("margin-top",0),x(d)}},stop:function(c,d){var e,f,g=u-b,h=d.item.closest(".article-list").get(0),i=d.item.prevAll().length;if(!d.item.hasClass("ui-draggable")){if(h.arlimaList.data.id==a.data.id&&a.data.isImported)return c.preventDefault(),o.remove(),!1;a.data.isImported&&(d.item[0].arlimaArticle.listID=h.arlimaList.data.id,d.item[0].arlimaArticle.addClickEvents(),ArlimaArticleForm.article&&ArlimaArticleForm.article.opt("overridingURL")==d.item[0].arlimaArticle.opt("overridingURL")&&(ArlimaArticleForm.article=!1,ArlimaArticleForm.edit(d.item[0].arlimaArticle),ArlimaArticleForm.article.data.image&&ArlimaArticleForm.article.data.image.url&&(window.ArlimaImageUploader.showPreloader(),window.ArlimaBackend.saveExternalImage(d.item[0].arlimaArticle.data.image.url,"",function(a){window.ArlimaImageUploader.removeNotice(),a&&window.ArlimaImageManager.setNewImage(a.url,a.attachment,!1,ArlimaArticleForm.article.data.image.size,ArlimaArticleForm.article.data.image.alignment)})))),e=j.children().insertAfter(d.item),e.length>0&&e.each(function(){D(r(this)),this.arlimaArticle.addClickEvents()}),0!==g&&(z(d.item,u),A(e,g)),a.updateParentProperties(),f=d.item[0].arlimaArticle.isChild(),!h||i==m&&f==n||h.arlimaList.toggleUnsavedState(!0),l||h&&h.arlimaList.data.id==a.data.id||a.toggleUnsavedState(!0),window.arlimaMoveBetweenLists?(a.updateParentProperties(),E()):G(d.item,!1)}},sort:function(a,b){var g=b.helper.offset(),j=g.left,l=w(j-b.placeholder.parent().offset().left);k&&(l=0),b.placeholder.parent().hasClass("articles")||(e.length?e.after(b.placeholder):s.prepend(b.placeholder)),x(b),(e.length&&!e[0].arlimaArticle.isChild()&&!e[0].arlimaArticle.canHaveChildren()||!q)&&(l=0),l>d?l=d:c>l&&(l=c),l!=u&&!k&&q&&v(b,l),h&&g.top+i>h&&(f.after(b.placeholder),x(b),r(this).sortable("refreshPositions"))},receive:function(b,c){var d;if(c.sender.hasClass("ui-draggable")){var e=new ArlimaArticle(r.extend(!0,{},c.item.context.arlimaArticle.data),a.data.id);e.$elem.insertAfter(a.$elem.find("ui-draggable")),e.$elem.addClass("list-item-depth-"+u).insertAfter(r(".ui-draggable",this)),a.$elem.find(".ui-draggable").remove(),d=e.$elem}else d=c.item,c.item[0].arlimaArticle.listID=a.data.id;G(d,!0),window.arlimaMoveBetweenLists=!0}})}var ArlimaUtils=function(a,b,c){var d={serverTime:0,isFutureDate:function(a){return a>this.serverTime},hasMetaKeyPressed:function(a){return a&&(a.ctrlKey||a.metaKey)},log:function(a,d){d===c&&(d="log"),"console"in b&&"function"==typeof b.console[d]&&b.console[d](a)},makeCollapsing:function(a,b){var c=!1;a.find(".collapse-toggle").click(function(){if(!c){c=!0;var d=a.find(".inside");d.is(":visible")?d.slideUp("fast",function(){c=!1,"function"==typeof b&&b()}):d.slideDown("fast",function(){c=!1,"function"==typeof b&&b()})}})},selectVal:function(a,b,c){var d=a.find('option[value="'+b+'"]');if(0==d.length){if(""!=b&&"aligncenter"!=b)throw Error("Trying to set value ("+b+") for a select that does not exist")}else a.val()!=b&&(d.get(0).selected=!0,c&&a.trigger("change"))},isImagePath:function(b){b||(b=""),b=b.toLowerCase();var c=!1;return a.each([".jpg",".jpeg",".gif",".png"],function(a,d){return b.indexOf(d)>-1?(c=!0,!1):void 0}),c},getUnsavedListInFocus:function(){if(b.ArlimaArticleForm.article)return b.ArlimaListContainer.list(ArlimaArticleForm.article.listID);if(ArlimaListContainer.lastTouchedList&&ArlimaListContainer.list(ArlimaListContainer.lastTouchedList)&&ArlimaListContainer.list(ArlimaListContainer.lastTouchedList).hasUnsavedChanges())return ArlimaListContainer.list(ArlimaListContainer.lastTouchedList);var c=[];return a.each(ArlimaListContainer.lists,function(a,b){b.hasUnsavedChanges()&&c.push(b)}),1==c.length?c[0]:void 0},shake:function(a){"hasUnsavedChanges"in a&&(a=a.$elem);try{a.effect("shake",{times:4,distance:10},500)}catch(b){}},makeDraggable:function(a){a.draggable({appendTo:"body",helper:"clone",sender:"postlist",connectToSortable:".article-list:not(.imported) .articles",revert:"invalid",start:function(a,b){b.helper.addClass("article"),b.helper.css("z-index","99999")}})}},e=(new Date).getTime();return setInterval(function(){var a=(new Date).getTime();ArlimaUtils.serverTime+=a-e,e=a},1e3),d}(jQuery,window),ArlimaBackend=function(a,b,c){var d,e=b.log;return a(function(){d=a("body")}),{queryPosts:function(a,b){this._ajax("arlima_query_posts",a,b)},getLaterVersion:function(a,b,c){this._ajax("arlima_check_for_later_version",{alid:a,version:b},c)},getPost:function(a,b){this._ajax("arlima_get_post",{postid:a},b,"json",!1)},getPostAttachments:function(a,b){this._ajax("arlima_get_attached_images",{postid:a},b)},connectAttachmentToPost:function(a,b,c){this._ajax("arlima_connect_attach_to_post",{attachment:b,post:a},c)},saveList:function(a,b,c){this._ajax("arlima_save_list",{alid:a,articles:b},c)},savePreview:function(a,b,c){this._ajax("arlima_save_list",{alid:a,articles:b,preview:1},c)},removeImageVersions:function(a,b){this._ajax("arlima_remove_image_versions",{attachment:a},b)},loadCustomTemplateData:function(a){this._ajax("arlima_print_custom_templates",{},a)},loadListData:function(a,b,c){this._ajax("arlima_add_list_widget",{alid:a,version:b},c)},loadListSetup:function(a){this._ajax("arlima_get_list_setup",{},a)},saveExternalImage:function(a,b,c){var d=a.substr(a.lastIndexOf(".")+1).toLowerCase(),e=d.indexOf("?");e>-1&&(d=d.substr(0,e)),this._ajax("arlima_save_external_img",{imgurl:a,postid:b},c)},saveImage:function(a,b,c,d){this._ajax("arlima_save_image",{image:a,postid:b,name:c},d)},saveListSetup:function(a,b){this._ajax("arlima_save_list_setup",{lists:a},b)},loadScissorsHTML:function(a,b){this._ajax("arlima_get_scissors",{attachment:a},b,"html")},duplicateImage:function(a,b){this._ajax("arlima_duplicate_image",{attachment:a},b)},_ajax:function(b,f,g,h,i){f.action=b,f._ajax_nonce=c.arlimaNonce,void 0===i&&(i=!0),void 0===h&&(h="json"),d&&i&&d.addClass("wait-loading"),a.ajax({url:c.ajaxURL,type:"POST",data:f,dataType:h,success:function(a){d&&d.removeClass("wait-loading"),a&&-1!=a?a.error&&(alert(a.error),a=!1):(alert(c.lang.loggedOut),a=!1),"function"==typeof g&&g(a)},error:function(a,b){if(d.removeClass("wait-loading"),0==a.status)return e("The request is refused by browser, most probably because of fast reloading of the page before ajax call was completed","warn"),void 0;var c=a.responseText;if("undefined"!=typeof JSON){var f=!1;try{f=JSON.parse(c)}catch(h){}f&&"undefined"!=typeof f.error&&(c=f.error)}alert("ERROR:\n------------\n"+c),e(a,"error"),e(b,"error"),"function"==typeof g&&g(!1)}})}}}(jQuery,ArlimaUtils,ArlimaJS),ArlimaArticleSettingsMenu=function(a,b){var c={hasFocus:!1,$button:!1,$dropDown:!1,defaultTemplate:!1,templateFormatsMap:{},open:function(){this.hasFocus=!0,this.$button.addClass("active"),this.$dropDown.slideDown("fast",function(){c.hasFocus=!0})},setup:function(b){this.$dropDown.find("i.fa-check-square-o").removeClass("fa-check-square-o").addClass("fa-square-o");var d=window.ArlimaListContainer.list(b.listID);this.defaultTemplate=d.data.options.template,this.$dropDown.find(".template .nav").show().each(function(){return a(this).attr("data-value")==c.defaultTemplate?(a(this).hide(),!1):void 0}),d.data.options.allows_template_switching&&b.canPreview()?this.$dropDown.find(".nav.template .disabled").removeClass("disabled"):this.$dropDown.find(".nav.template .nav").addClass("disabled"),b.canPreview()?(this.$dropDown.find(".nav.format .disabled").removeClass("disabled"),this.onTemplateChange(window.ArlimaArticleForm.article.getTemplate())):this.$dropDown.find(".nav.format .nav").addClass("disabled"),this.$dropDown.children().each(function(){var c=a(this),d=c.attr("data-prop"),e="";if(d.indexOf(":")>0){var f=d.split(":");e=f[0]in b.data?b.data[f[0]][f[1]]||"":""}else e=b.data[d]||"";c.find(".sub .nav").each(function(){return a(this).attr("data-value")==e?(a(this).find("i").removeClass("fa-square-o").addClass("fa-check-square-o"),!1):void 0})})},onTemplateChange:function(b){var c=this.$dropDown.find(".format .nav");b in this.templateFormatsMap&&0!=this.templateFormatsMap[b].length?(-1==a.inArray(window.ArlimaArticleForm.opt("format"),this.templateFormatsMap[b])&&d(c.eq(0)),c.addClass("disabled").eq(0).removeClass("disabled"),a.each(this.templateFormatsMap[b],function(a,b){c.filter('*[data-value="'+b+'"]').removeClass("disabled")})):c.removeClass("disabled")},onMouseEnter:function(){this.isOpen()&&(this.hasFocus=!0)},onMouseLeave:function(){this.hasFocus=!1,setTimeout(function(){c.hasFocus||c.close()},1e3)},close:function(){this.hasFocus=!1,this.$button.removeClass("active"),this.$dropDown.slideUp("fast")},isOpen:function(){return this.$dropDown.is(":visible")},addSelect:function(e){var f=a('<div class="nav">'+e.attr("data-label")+'<div class="sub"></div></div>'),g=f.find(".sub");f.addClass(e.attr("data-prop").split(":").pop()).attr("data-prop",e.attr("data-prop")).bind("mouseenter",function(){c.$dropDown.find(".sub").hide();var a=f.position();g.css({right:a.left+c.$dropDown.outerWidth()-2+"px",top:a.top+"px"}).show()}).bind("mouseleave",function(){g.hide()}),g.bind("mouseover",function(){c.hasFocus=!0}).bind("mouseleave",function(){c.onMouseLeave()}),e.find("option").each(function(){var e=a('<div class="nav" data-value="'+a(this).attr("value")+'"><i class="fa fa-square-o"></i> '+a(this).text()+"</div>");e.click(function(){if(e=a(this),!e.hasClass("disabled")){var f=e.find("i");if(f.hasClass("fa-check-square-o"))"options:scheduled"==e.parent().parent().attr("data-prop")&&window.ArlimaScheduledIntervalPicker.open();else{d(e);var g=e.parent().parent().attr("data-prop"),h=e.attr("data-value"),i=window.ArlimaArticleForm.$form.find('select[data-prop="'+g+'"]');b.selectVal(i,h,!0),i.hasClass("templates")&&c.onTemplateChange(h||c.defaultTemplate),"options:scheduled"==g&&(h?window.ArlimaScheduledIntervalPicker.open():window.ArlimaScheduledIntervalPicker.removePickedInterval())}}}),g.append(e)}),this.$dropDown.append(f)},init:function(b,d){this.$dropDown=d,this.$button=b,d.slideUp("fast"),b.bind("click",function(){c.isOpen()?c.close():c.open(),a(this).blur()}).bind("mouseleave",function(){c.onMouseLeave()}).bind("mouseover",function(){c.onMouseEnter()}),d.bind("mouseleave",function(){c.onMouseLeave()}).bind("mouseenter",function(){c.onMouseEnter()})}},d=function(a){var b=a.find("i");b.hasClass("fa-check-square-o")||(a.siblings().find("i").removeClass("fa-check-square-o").addClass("fa-square-o"),b.removeClass("fa-square-o").addClass("fa-check-square-o"))};return c}(jQuery,ArlimaUtils),ArlimaList=function(a,b,c,d,e){"use strict";function f(b){this.$elem=a(g),this._isUnsaved=!1;var c=this,d=this.$elem.find(".articles");if(this.$elem.resizable({containment:"parent",start:function(){c.$elem.css("overflow","hidden"),d.css("overflow-y","hidden"),d.find(".article").css("visibility","hidden")},stop:function(){c.$elem.css("overflow","visible"),c.$elem.trigger("resized"),d.find(".article").css("visibility","visible"),d.css("height","100%").css({height:d.height()+"px",overflowY:"auto"})}}).draggable({containment:"parent",snap:20,handle:".header",stop:function(){c.$elem.trigger("dragged")}}),b.isImported){this.$elem.addClass("imported"),setTimeout(function(){c.$elem.find(".article .remove").remove(),c.$elem.find(".footer .save").remove(),c.$elem.find(".footer .preview").remove()},50);var e=setInterval(function(){c.reload()},9e4);this.$elem.bind("removedFromContainer",function(){clearInterval(e)})}this.$elem.bind("addedToContainer",function(){d.css("height",d.height()+"px"),arlimaNestedSortable(c)}),this.setData(b),j(this),this.$elem.get(0).arlimaList=this}var g='<div class="article-list"><div class="header"><span><a href="#" class="remove">&times;</a><a href="#" class="add-section">+</a><span class="title"></span></span></div><div class="articles"></div><div class="footer"><a href="#" class="preview" title="'+c.lang.preview+'"><i class="fa fa-eye"></i></a><a href="#" class="save" title="'+c.lang.publish+'"><i class="fa fa-save"></i></a><img src="'+c.pluginURL+'/images/ajax-loader-trans.gif" class="ajax-loader" /><a href="#" class="refresh" title="'+c.lang.reload+'"><i class="fa fa-refresh"></i></a><span class="version"><div class="number"></div><select class="previous-versions"></select></span></div></div>';f.prototype.getArticleData=function(){var a=[];return this.$elem.find(".article").each(function(){this.arlimaArticle.isChild()?a[parseInt(this.arlimaArticle.data.parent,10)].children.push(this.arlimaArticle.data):(this.arlimaArticle.data.children=[],a.push(this.arlimaArticle.data))}),a},f.prototype.size=function(){return this.$elem.find(".article").length},f.prototype.numSections=function(){return this.$elem.find(".article.section-divider").length},f.prototype.setArticles=function(b){var c=this;a.each(b,function(b,d){c.addArticle(new ArlimaArticle(d,c.data.id),!1),d.children.length>0&&a.each(d.children,function(a,b){var d=new ArlimaArticle(b,c.data.id,!1);d.$elem.addClass("list-item-depth-1"),c.addArticle(d,!1)})})},f.prototype.addArticle=function(a,b){this.$elem.find(".articles").append(a.$elem),a.listID=this.data.id,b&&this.toggleUnsavedState(!0)},f.prototype.preview=function(){b.ArlimaListPreview.preview(this)},f.prototype.setData=function(b){this.data=b;var d=b.title,e=this.$elem.find(".header .title");a.trim(e.text())!=d&&e.text(d),c.isAdmin&&b.options.supports_sections&&!b.isImported?this.$elem.find(".add-section").show():this.$elem.find(".add-section").hide(),h(this)},f.prototype.toggleUnsavedState=function(a){if(a=a===!0,a!=this._isUnsaved){this._isUnsaved=a;var b=this.$elem.find(".header .title");b.find(".dot").remove(),this._isUnsaved?(this.$elem.addClass("unsaved"),b.prepend('<span class="dot">&nbsp;</span>')):this.$elem.removeClass("unsaved")}},f.prototype.toggleAjaxPreLoader=function(a){i(this,a)},f.prototype.reload=function(a){var c=this;this.loadedVersion=a,this.$elem.find(".articles").html(""),b.ArlimaArticleForm.isEditing(this.data.id)&&b.ArlimaArticleForm.clear(),this.toggleUnsavedState(a&&a!=this.data.version.id?!0:!1),i(this,!0),b.ArlimaListLoader.load(this,function(){i(c,!1)},a)},f.prototype.hasUnsavedChanges=function(){return this._isUnsaved},f.prototype.fixFutureNotices=function(){this.$elem.find(".future").each(function(){})},f.prototype.article=function(a){return this.$elem.find(".article").get(a).arlimaArticle},f.prototype.dump=function(){this.$elem.find(".article").each(function(){e.log(this.arlimaArticle)})},f.prototype.save=function(){if(this.hasUnsavedChanges()){this.toggleUnsavedState(!1),i(this,!0),delete this.loadedVersion;var a=this;d.getLaterVersion(this.data.id,this.data.version.id,function(d){if(d){var e=!0;d.version&&(e=confirm(c.lang.laterVersion+" \r\n "+d.versioninfo+"\r\n"+c.lang.overWrite)),a.$elem.find(".streamer-extra").length>1&&(e=confirm(c.lang.severalExtras+"\r\n"+c.lang.overWrite)),e?b.ArlimaListLoader.save(a,function(c){i(a,!1),c&&(a.setData(c),b.ArlimaArticleForm.isEditing(a.data.id)&&b.ArlimaArticleForm.toggleUnsavedState("saved"))}):i(a,!1)}})}},f.prototype.updateParentProperties=function(){var b=-1;this.$elem.find(".article").each(function(){var c=a(this);c.hasClass("list-item-depth-1")?this.arlimaArticle.data.parent=b:(this.arlimaArticle.data.parent="-1",b++),this.arlimaArticle.children=[]})};var h=function(c){if(c.data.isImported)c.$elem.find(".version .number").text(c.data.versionDisplayText);else{var d=c.$elem.find(".version .number"),e=c.$elem.find(".previous-versions"),f=c.loadedVersion||c.data.version.id;d.html("v. "+f).attr("title",c.data.versionDisplayText).qtip({position:{my:"right top",at:"center left",viewport:jQuery(b)},style:b.qtipStyle}),e.html(""),a.each(c.data.versions,function(b,c){var d=a("<option></option>",{value:c,selected:c==f}).text("v. "+c);e.append(d)})}},i=function(a,b){var c=a.$elem.find(".ajax-loader");b?(c.show(),a.$elem.find(".footer a").addClass("disabled")):(a.$elem.find(".footer a").removeClass("disabled"),c.hide())},j=function(d){d.$elem.find(".refresh").click(function(a){var b=!0;return d.hasUnsavedChanges()&&!e.hasMetaKeyPressed(a)&&(b=confirm(c.lang.hasUnsavedChanges)),b&&d.reload(),!1}),d.$elem.find(".preview").click(function(){return d.data.isImported||d.preview(),!1}),d.$elem.find(".save").click(function(){return d.save(),!1}),d.$elem.find(".remove").click(function(a){return b.ArlimaListContainer.remove(d,a),!1}),d.$elem.find(".add-section").click(function(){var a={title:"Section divider "+(d.numSections()+1),options:{sectionDivider:1}};return d.addArticle(new ArlimaArticle(a),!0),!1});var f=d.$elem.find(".version"),g=!1,h=d.$elem.find(".previous-versions");h.bind("mouseenter",function(){g=!0}).bind("mouseleave",function(){g=!1,setTimeout(function(){h.parent().is(":visible")&&!g&&(f.find(".number").show(),h.hide())},1200)}).bind("change",function(){d.reload(a(this).val())}),f.find(".number").click(function(){return a(this).hide(),h.show(),g=!0,!1})};return f}(jQuery,window,ArlimaJS,ArlimaBackend,ArlimaUtils),ArlimaArticle=function(a,b,c,d){function e(b,c,d,g){this.$elem=d?d:a(f),g===!1&&this.$elem.find(".remove").remove(),this.setData(a.extend(!0,{},e.defaultData,b)),this.listID=c,this.$elem[0].arlimaArticle=this,this.$elem.attr("title",new Date(1e3*b.published)),this.addClickEvents()}var f='<div class="article"><div class="article-title-container"><span class="article-title"></span><a href="#" class="remove">&times;</a></div><div class="children-transport"></div></div>';e.prototype.addClickEvents=function(){var e=this,f=this.$elem.find(".remove");this.$elem.unbind("click").click(function(){b.ArlimaArticleForm.edit(e)}),0==f.length&&(f=a('<a href="#" class="remove">&times;</a>').appendTo(this.$elem.find(".article-title-container"))),f.unbind("click").click(function(a){var b=c.lang.wantToRemove+e.$elem.find(".article-title").text()+c.lang.fromList;return(d.hasMetaKeyPressed(a)||confirm(b))&&e.remove(),a.stopPropagation(),!1})},e.prototype.setData=function(a){g(a,this.data)?(this.data=a,this.updateTitleElement()):this.data=a,this.isPublished()?this.$elem.removeClass("future"):this.$elem.addClass("future")},e.prototype.updateTitleElement=function(a){var b="";if(this.data.title?b=this.data.title.replace(/__/g,""):this.data.content&&(b+="["+this.data.content.replace(/(<.*?>)/gi,"").substring(0,30)+"...]"),this.opt("preTitle")&&(b=this.opt("preTitle")+" "+b),this.opt("streamerType")){var c;switch(this.opt("streamerType")){case"extra":c="rgba(0,0,0, .5)";break;case"image":c="rgba(0,0,0, .5)";break;default:c="#"+this.opt("streamerColor")}"#"==c&&(c="black"),b='<span class="streamer-indicator" style="background:'+c+'"></span> '+b}this.opt("sectionDivider")&&(this.$elem.addClass("section-divider"),b="&ndash;&ndash;&ndash; "+b+" &ndash;&ndash;&ndash;"),this.opt("adminLock")&&(b='<span class="fa fa-lock"></span>'+b),this.opt("scheduled")&&(b='<span class="fa fa-clock-o"></span>'+b),this.opt("fileInclude")&&(b='<span class="fa fa-bolt"></span>'+b),this.isPublished()||(b='<span class="fa fa-calendar"></span>'+b),this.$elem.find(".article-title").html(b),a&&(this.isPublished()?this.$elem.removeClass("future"):this.$elem.addClass("future"))},e.prototype.isPublished=function(){return!d.isFutureDate(1e3*this.data.published)},e.prototype.isChild=function(){return parseInt(this.data.parent,10)>-1},e.prototype.remove=function(){var d=!1,e=b.ArlimaListContainer.list(this.listID);return this.opt("adminLock")&&!c.isAdmin?(alert(c.lang.adminLock),void 0):(b.ArlimaArticleForm.isEditing(this.$elem)?b.ArlimaArticleForm.clear():this.isChild()&&(d=b.ArlimaArticlePreview.isPreviewed(this)),a.each(this.getChildArticles(),function(a,b){b.remove()}),this.$elem.remove(),d&&b.ArlimaArticlePreview.reload(),e.toggleUnsavedState(!0),e.updateParentProperties(),e.$elem.trigger("change"),void 0)},e.prototype.getChildIndex=function(){var b=-1,c=this.getParentArticle(),d=this;return c&&a.each(c.getChildArticles(),function(a,c){return c.$elem.get(0)==d.$elem.get(0)?(b=a,!1):void 0}),b},e.prototype.getChildArticles=function(){for(var a=this.$elem.prevAll().not(".list-item-depth-1").length,b=this.$elem.next(),c=[];b.length>0&&b[0].arlimaArticle&&b[0].arlimaArticle.data.parent==a;)c.push(b[0].arlimaArticle),b=b.next();return c},e.prototype.getTemplate=function(){var a=this.opt("template");return a||(this.listID?a=b.ArlimaListContainer.list(this.listID).data.options.template:(d.log("Trying to get template of an article that is not yet related to any list","warn"),a=void 0)),a},e.prototype.getParentArticle=function(){if(this.isChild())try{return this.$elem.parent().find(".article").not(".list-item-depth-1").get(this.data.parent).arlimaArticle}catch(a){console.log(this.$elem.parent()),console.log(this.$elem),console.log((new Error).stack)}},e.prototype.opt=function(a){return this.data.options[a]},e.prototype.canPreview=function(){return!this.opt("fileInclude")&&!this.opt("sectionDivider")},e.prototype.canHaveChildren=function(){return this.canPreview()},e.prototype.canBeChild=function(){return!this.opt("sectionDivider")};var g=function(a,b){return!b||a.title!=b.title||a.options.preTitle!=b.options.preTitle||a.options.adminLock!=b.options.adminLock||a.options.scheduled!=b.options.scheduled||a.options.streamerColor!=b.options.streamerColor||a.options.streamerType!=b.options.streamerType};return e}(jQuery,window,ArlimaJS,ArlimaUtils),ArlimaArticlePreview=function(a,b,c){var d=a(document),e={article:null,$iframe:null,$iframeBody:null,isRendered:!1,$elem:!1,templateContent:null,titleElem:null,lastHeightChange:null,setArticle:function(a,b,c,d,e){this.article=a,!a.canPreview()||e?this.isVisible()&&this.hide():(this.titleElem=d||"h2",this.setTemplate(b),this.$elem.css({width:c+"px",marginLeft:"-"+(c+20)+"px"}))},setTemplate:function(a){this.templateContent=f(a),this.lastHeightChange=null,this.isVisible()?h():this.isRendered=!1},reload:function(){var a=b.ArlimaTemplateLoader.templates[this.article.getTemplate()];this.setArticle(this.article,a,this.$elem.width(),this.titleElem)},update:function(b){if(this.isRendered){var c={streamer:["options:streamerType","options:streamerColor","options:streamerContent"],title:["options:preTitle","title","size"],post:["post"],content:["content"],format:["options:format"],imageSource:["image:attachment"],imageSettings:["image:size","image:alignment"]},d=b.attr("data-prop");a.each(c,function(b,c){var e=!1;return a.each(c,function(a,c){return c==d?(e=!0,j(b),!1):void 0}),e?!1:void 0})}},isPreviewed:function(b){var c=!1;if(this.article)if(this.article.isChild()&&this.article.getParentArticle().$elem[0]==b.$elem[0])c=!0;else if(this.article.$elem[0]==b.$elem[0])c=!0;else if(b.isChild()){var d=this.article.isChild()?this.article.getParentArticle().getChildArticles():this.article.getChildArticles();a.each(d,function(a,d){return d.$elem[0]==b.$elem[0]?(c=!0,!1):void 0})}return c},isVisible:function(){return this.$elem.is(":visible")},show:function(){this.article.opt("sectionDivider")||(this.$elem.show(),this.isRendered||h())},hide:function(){this.$elem.hide()},toggle:function(){this.isVisible()?this.hide():this.show()},init:function(c){this.$elem=c,c.html('<iframe name="arlima-preview-iframe" id="arlima-preview-iframe" style="overflow: hidden; width: 100%; height:0" scrolling="no" border="0" frameborder="0"></iframe>'),this.$iframe=this.$elem.find("iframe").contents(),"arlimaTemplateStylesheets"in b&&a.each(b.arlimaTemplateStylesheets,function(a,b){e.$iframe.find("head").append('<link rel="stylesheet" type="text/css" href="'+b+'" />')}),this.$iframe.find("html,body").css({border:0,padding:0,margin:0,overflow:"hidden"}).addClass("arlima-preview"),this.$iframeBody=this.$iframe.find("body")},getContentElement:function(){return this.$iframeBody.find(".template-placeholder-content").eq(0)},getTitleElement:function(){return this.$iframeBody.find(".template-placeholder-title").eq(0)}},f=function(a){return a.replace("{{{html_image}}}",'<span class="template-placeholder-image">{{{html_image}}}</span>').replace("{{{html_title}}}",'<span class="template-placeholder-title">{{{html_title}}}</span>').replace("{{title}}",'<span class="template-placeholder-title-plain">{{title}}</span>').replace("{{{html_content}}}",'<span class="template-placeholder-content">{{{html_content}}}</span>').replace("{{{content}}}",'<span class="template-placeholder-content-plain">{{{content}}}</span>').replace("{{class}}","template-placeholder-format {{class}}").replace("{{{html_streamer}}}",'<span class="template-placeholder-streamer">{{{html_streamer}}}</span>')},g=function(){var a=e.$iframeBody.children().eq(0).outerHeight();a||(a=400),e.lastHeightChange!=a&&(e.lastHeightChange=a,e.$elem.find("iframe").css("height",a+"px"))},h=function(){var a;e.isRendered=!0,e.$iframeBody.html(""),e.article.isChild()?a=i(e.article.getParentArticle(),!1,!1,e.article.getChildIndex()):(a=i(e.article,e.templateContent),a.eq(0).addClass("main-article-preview")),a.find("img").bind("load",g),a.appendTo(e.$iframeBody),d.trigger("previewUpdate","all"),g()},i=function(d,f,g,h,j,p){if(!f&&(f=b.ArlimaTemplateLoader.templates[d.getTemplate()],!f))return alert("Use of template that does not exist "+d.getTemplate()),j?"":a("<div></div>");if(-1==f.indexOf("{{class}}"))return alert("Use of template that is missing {{class}} variable"),j?"":a("<div></div>");if(-1==f.indexOf('data-post="{{post}}"'))return alert('Use of template that is missing attribute data-post="{{post}}"'),j?"":a("<div></div>");var q=a.extend(!0,{},d.data);if(q.html_title=k(d),q.html_content=o(d),q.html_streamer=m(d),q.class=l(d),q.html_image=n(d),q.child_articles="",p&&(q.class+=p),!g&&f.indexOf("{{{child_articles}}}")>-1){var r="",s="",t=!1,u=d.getChildArticles(),v=u.length%2===0;a.each(u,function(a,b){s="",(4==u.length&&(1==a||2==a)||6==u.length&&0!=a&&3!=a||u.length>1&&4!=u.length&&6!=u.length&&(0!=a||v))&&(s=1==a&&u.length>2||0==a&&2==u.length||3==a||4==a&&6==u.length?" first":" last"," first"==s&&(r+='<div class="arlima child-wrapper">',t=!0)),s&&(s+=" teaser-split"),r+=a===h?i(b,e.templateContent,!0,!1,!0,s+" teaser-child"):i(b,!1,!0,!1,!0,s+" teaser-child"),t&&"last"==s&&(r+="</div>",t=!1)}),t&&(r+="</div>"),q.child_articles='<div class="teaser-children children-'+u.length+'">'+r+"</div>"}var w=c.render(f,q);return j?w:a(w)},j=function(c){if("imageSource"==c||"post"==c)return e.reload(),void 0;if("imageSettings"==c){var f=e.$iframeBody.find(".template-placeholder-image img");f.length>0&&(f.removeClass("alignright alignleft half third quarter fifth sixth"),f.addClass(e.article.data.image.alignment),f.addClass(e.article.data.image.size),e.$iframeBody.find(".template-placeholder-format").addClass(l(e.article)))}else if("format"==c){var h=e.$iframeBody.find(".template-placeholder-format");a.each(b.ArlimaArticleForm.$form.find(".formats option"),function(){h.removeClass(a(this).attr("value"))})}else{var i,j="";switch(c){case"title":i=k(e.article),j=e.article.data.title;break;case"content":i=o(e.article),j=e.article.data.content;break;case"streamer":i=m(e.article)}e.$iframeBody.find(".template-placeholder-"+c).html(i),e.$iframeBody.find(".template-placeholder-"+c+"-plain").html(j)}("streamer"==c||"imageSettings"==c)&&e.$iframeBody.find(".template-placeholder-format").removeClass("img-full img-half img-third img-fourth img-fifth img-sixth no-img has-streamer no-streamer").addClass(l(e.article)),d.trigger("previewUpdate",[c]),g()},k=function(a){if(a.data.title){var b=a.data.title.replace("__","<br />"),c=a.opt("preTitle");return c&&(b='<span class="arlima-pre-title">'+c+"</span> "+b),"<"+e.titleElem+' style="font-size:'+a.data.size+'px">'+b+"</"+e.titleElem+">"}return""},l=function(a){var b=["teaser"];return a.data.image&&a.data.image.attachment?b.push("img-"+a.data.image.size):b.push("no-img"),a.opt("streamerType")?b.push("has-streamer"):b.push("no-streamer"),a.opt("format")&&b.push(a.opt("format")),b.join(" ")},m=function(a){return"text"==a.opt("streamerType")?'<div class="streamer text color-'+a.opt("streamerColor")+'" style="background: #'+a.opt("streamerColor")+'">'+a.opt("streamerContent")+"</div>":"extra"==a.opt("streamerType")?'<div class="streamer extra">Extra</div>':"image"==a.opt("streamerType")?'<div class="streamer image"><img src="'+a.opt("streamerContent")+'" alt="" /></div>':""!=a.opt("streamerContent")?'<div class="streamer '+a.opt("streamerType")+'">'+a.opt("streamerContent")+"</div>":""},n=function(a){return a.data.image&&a.data.image.url?'<img src="'+a.data.image.url+'" class="arlima-preview-img '+a.data.image.size+" "+a.data.image.alignment+'" />':""},o=function(b){if(""!=b.data.content){var c=a.trim(b.data.content);return 0!==b.data.content.indexOf("<p")&&(c="<p>"+c+"</p>"),c}return""};return e}(jQuery,window,Mustache,ArlimaUtils),ArlimaArticleForm=function(a,b,c,d,e,f){var g={article:!1,state:"saved",$form:!1,$formInputs:!1,$streamerContainer:!1,$streamerButton:!1,$controls:!1,$fileIncludeContainer:!1,edit:function(a){if(b._removeSliderKeyDownEvent(),this.$form.is(":visible")||this.$form.parent().find(".collapse-toggle").trigger("click"),!this.isEditing(a.$elem)){this.article&&this.article.$elem.removeClass("editing"),b.ArlimaListContainer.showAsActive(a.listID),this.article=a,a.$elem.addClass("editing");
var c=b.ArlimaListContainer.list(a.listID);this.$controls.find("a").not(".save").removeClass("disabled"),c.hasUnsavedChanges()?this.toggleUnsavedState("unsaved"):this.toggleUnsavedState("saved"),a.canPreview()||this.$controls.find(".preview").addClass("disabled"),b.ArlimaVersionManager.setArticle(a),this.setupForm(c)}},setupForm:function(i){if(i||(i=b.ArlimaListContainer.list(this.article.listID)),this.$formInputs.val("").each(function(){var b,c=a(this),e=c.attr("data-prop");if(e.indexOf(":")>0){var f=e.split(":");b=f[0]in g.article.data?g.article.data[f[0]][f[1]]||"":""}else b=g.article.data[e]||"";if("SELECT"==this.nodeName)try{d.selectVal(c,b)}catch(h){"options:template"!=e?d.log(h.message,"error"):delete g.article.data.options.template}else c.val(b)}),this.toggleEditorFeatures(),i.data.isImported||this.opt("adminLock")&&!f.isAdmin?(b.ArlimaFormBlocker.removeBlockers(),b.ArlimaFormBlocker.toggleFormBlocker(!0,i.data.isImported?!1:f.lang.adminLock)):b.ArlimaFormBlocker.toggleFormBlocker(!1),this.opt("streamerType")&&d.selectVal(this.$streamerContainer.find(".streamer-type-select"),this.opt("streamerType"),!1),this.$streamerContainer.find(".image").remove(),this.updateStreamerInputsContainer(!0),this.$form.find(".font-size-slider").slider("value",this.article.data.size),h(this.article.data.content),this.opt("fileInclude")){var j=this.opt("fileInclude"),k=j.replace(/^.*[\\\/]/,"");this.$fileIncludeContainer.show(),this.$fileIncludeContainer.find(".file").text(j.split("/wp-content")[1]||j),this.$fileIncludeContainer.find(".args").remove();var l=a("#arlima-article-file-includes").find('[data-label="'+k+'"]').attr("data-args");if(l){var m="";a.each(JSON.parse(l),function(a,b){m+="<strong>"+a+"</strong> = "+b+"<br />"}),this.$fileIncludeContainer.append('<p class="args"><span style="color:#999">'+m+"</span></p>")}}else this.$fileIncludeContainer.hide();e.setup(this.article),b.ArlimaArticleConnection.setup(this.article),c.setArticle(this.article,b.ArlimaTemplateLoader.templates[this.article.getTemplate()],i.data.previewWidth,!1,i.data.isImported),b.ArlimaImageManager.setup(this.article),b.ArlimaImageUploader.removeNotice()},opt:function(a){return this.article.opt(a)||""},clear:function(){b.ArlimaListContainer.showAsActive(!1),c.hide(),this.$form.is(":visible")&&this.$form.parent().find(".collapse-toggle").trigger("click"),this.$controls.find("a").addClass("disabled"),this.$formInputs.val(""),d.selectVal(this.$formInputs.filter("select"),""),h(""),this.state="saved",this.article&&this.article.$elem&&(this.article.$elem.removeClass("editing"),this.article=!1),b.ArlimaVersionManager.clear()},updateStreamerInputsContainer:function(b){if(this.opt("streamerType")){this.$streamerContainer.show();var c=this.$streamerContainer.find(".content"),e=this.$streamerContainer.find(".image"),g=this.$streamerContainer.find("div:not(.streamer-images)");switch(this.opt("streamerType")){case"extra":this.change(c,"Extra",!0),c.hide(),g.hide(),e.remove();break;case"image":if(c.hide(),g.hide(),0==e.length){var h="["+f.lang.chooseImage+"]";d.isImagePath(this.opt("streamerContent"))?h='<img src="'+this.opt("streamerContent")+'" />':this.opt("streamerContent")&&this.change(c,""),e=a('<a href="#" class="image">'+h+"</a>").insertAfter(g.eq(0)),e.on("click",function(){return a.fancybox({autoScale:!0,transitionIn:"elastic",transitionOut:"elastic",speedIn:500,speedOut:300,autoDimensions:!0,centerOnScroll:!0,href:"#streamer-images"}),!1})}break;case"text":d.isImagePath(this.opt("streamerContent"))&&this.change(c,""),c.show(),e.remove(),g.show().css("background","#"+this.opt("streamerColor"));break;default:d.isImagePath(this.opt("streamerContent"))&&this.change(c,""),c.show(),e.remove(),g.hide()}b&&(this.$streamerButton.find("i").removeClass("fa-square-o").addClass("fa-check-square-o"),this.$streamerButton.addClass("active"))}else this.$streamerContainer.hide(),b&&(this.$streamerButton.removeClass("active"),this.$streamerButton.find("i").removeClass("fa-check-square-o").addClass("fa-square-o"))},toggleEditorFeatures:function(){var c=b.ArlimaFormBlocker,d=b.ArlimaTemplateLoader.getTemplateSupport(this.article),e=this.$form.find(".template-feature");this.article.opt("sectionDivider")||this.article.opt("fileInclude")?(e.filter('[data-feature="image"]').hide(),e.filter('[data-feature="editor"]').hide(),e.filter('[data-feature="connection"]').hide(),c.toggleStreamerBlocker(!1),c.toggleTitleBlocker(!0),this.article.data.options.fileInclude&&(c.toggleStreamerBlocker(!0),e.filter('[data-feature="file-include"]').show())):(c.removeBlockers(),e.show(),a.each(d,function(a,b){"imageSize"==a||b||c.addBlocker(a)||e.filter('[data-feature="'+a+'"]').hide()}))},serialize:function(){var b=a.extend(!0,{},this.article.data);return this.$formInputs.each(function(){var c=a(this),d=c.attr("data-prop");if(d)if(d.indexOf(":")>0){var e=d.split(":");e[0]in b||(b[e[0]]={}),b[e[0]][e[1]]=c.val()}else b[d]=c.val()}),b},isEditing:function(b){return this.article?a.isNumeric(b)?b==this.article.listID:b[0].arlimaArticle&&b[0].arlimaArticle==this.article.$elem[0].arlimaArticle:!1},toggleUnsavedState:function(a){this.state=a,"saved"==this.state?this.$controls.find(".save").addClass("disabled"):(this.$controls.find(".save").removeClass("disabled"),b.ArlimaListContainer.list(this.article.listID).toggleUnsavedState(!0))},change:function(b,c,e){void 0===e&&(e=!0),"string"==typeof b&&(b=(b.indexOf("streamer")>-1?this.$streamerContainer:this.$form).find(b)),"SELECT"==b.get(0).nodeName?d.selectVal(b,c,e):(c=a.trim(c),b.val()!=c&&(b.val(c),e&&b.trigger("change")))},getEditorContent:function(){return h()},init:function(h,i){d.makeCollapsing(h,function(){h.is(":visible")?g.$form.trigger("open"):g.$form.trigger("closed")}),this.$form=h.find(".inside"),this.$streamerButton=h.find(".button.streamer"),this.$streamerContainer=h.find(".streamer-container"),this.$fileIncludeContainer=h.find(".file-include-container"),this.$controls=i,i.find(".save").click(function(){return"unsaved"==g.state&&(g.toggleUnsavedState("saved"),b.ArlimaListContainer.list(g.article).save()),!1}),i.find(".preview").click(function(){return a(this).hasClass("disabled")||c.toggle(),!1}),i.find(".preview-list").click(function(){return a(this).hasClass("disabled")||b.ArlimaListContainer.list(g.article.listID).preview(),!1});var j=h.find(".formats"),k=h.find(".templates"),l={};e.init(h.find("button.settings"),h.find(".settings-menu")),e.addSelect(j),e.addSelect(k),e.addSelect(h.find(".scheduled-settings")),f.isAdmin&&e.addSelect(h.find(".admin-lock")),k.find("option").each(function(){l[a(this).attr("value")]=[]}),j.find("option").each(function(){var b=a(this).attr("value"),c=a(this).attr("data-template");c?a.each(c.split(","),function(a,c){c in l||(l[c]=[]),l[c].push(b)}):a.each(l,function(a){l[a].push(b)})}),e.templateFormatsMap=l;var m=!1,n=a(document),o=h.find("input.font-size"),p=function(b){var c=b.keyCode?b.keyCode:b.which;if(a.inArray(c,[39,37])>-1&&g.article){m=(new Date).getTime();var d=parseInt(o.val(),10);return d+=37==c?-1:1,r.slider("value",d),g.change(o,d),q(),!1}},q=function(){setTimeout(function(){(!m||(new Date).getTime()-5e3>m)&&_removeSliderKeyDownEvent()},5e3)},r=h.find(".font-size-slider").slider({value:18,min:8,max:100,slide:function(a,c){b.hasSliderFocus=!0,g.change(o,c.value)}}).mousedown(function(){b.hasSliderFocus=!0}),s=h.find(".ui-slider-handle");b._removeSliderKeyDownEvent=function(){m=!1,s.removeClass("active"),n.unbind("keydown",p)},h.find(".ui-slider-handle,input.font-size").bind("focus click",function(){s.addClass("active"),h.find("input").one("focus",_removeSliderKeyDownEvent),n.on("keydown",p),q(),m=(new Date).getTime()});var t=this.$streamerContainer.find(".streamer-type-select");this.$streamerButton.click(function(){g.$streamerButton.hasClass("active")?(g.$streamerButton.removeClass("active"),g.$streamerButton.find("i").removeClass("fa-check-square-o").addClass("fa-square-o"),g.change(".streamer-type",""),g.change(g.$streamerContainer.find(".content"),""),g.$streamerContainer.find(".image").remove()):(g.$streamerButton.addClass("active"),g.$streamerButton.find("i").removeClass("fa-square-o").addClass("fa-check-square-o"),"extra"==t.val()&&g.$streamerContainer.find(".content").val("Extra"),g.change(".streamer-type",t.val())),g.$streamerButton.blur(),g.updateStreamerInputsContainer(!1)}),t.bind("change",function(){g.change(".streamer-type",a(this).val()),g.updateStreamerInputsContainer(!1)}),h.find("select.streamer-color").colourPicker({ico:"",name:"apa",title:!1}),h.find(".streamer-images img").click(function(){var b=a(this);g.$streamerContainer.find(".image").html(b.clone()),a(".fancybox-close").trigger("click"),g.change(g.$streamerContainer.find(".content"),b[0].src)}),setTimeout(function(){h.find('input[name="options:streamerColor"]').attr("data-prop","options:streamerColor").addClass("data"),g.$formInputs=h.find(".data");var d=!1;g.$formInputs.bind("change",function(){var e,f=a(this);if(g.article&&(e=f.attr("data-prop"))){if(e.indexOf(":")>0){var h=e.split(":");h[0]in g.article.data||(g.article.data[h[0]]={}),g.article.data[h[0]][h[1]]=f.val()}else g.article.data[e]=f.val();"saved"==g.state&&g.toggleUnsavedState("unsaved"),"options:template"==e?(g.toggleEditorFeatures(),g.updateStreamerInputsContainer(),c.setTemplate(b.ArlimaTemplateLoader.templates[g.article.getTemplate()])):c.update(f),"text"==f.get(0).type&&"size"!=e?d=!0:(d=!1,b.ArlimaVersionManager.addVersion(g.article));var i=["options:preTitle","title","options:streamerType","options:streamerContent","options:adminLock","options:scheduled"];a.inArray(e,i)>-1&&g.article.updateTitleElement(!1)}}).bind("keyup",function(){var b=a(this),c=b.attr("data-prop"),d=c.split(":"),e=d[0]in g.article.data?g.article.data[d[0]][d[1]]||"":"";e!=b.val()&&b.trigger("change")}).bind("blur",function(){d&&a(this).attr("data-prop")&&b.ArlimaVersionManager.addVersion(g.article)})},500)}},h=function(c){var d=b.tinyMCE.activeEditor&&!b.tinyMCE.activeEditor.isHidden();return void 0===c?d?b.tinyMCE.activeEditor.getContent():a("#tinyMCE").val():(d?b.tinyMCE.activeEditor.setContent(c):a("#tinyMCE").val(c),void 0)};return g}(jQuery,window,ArlimaArticlePreview,ArlimaUtils,ArlimaArticleSettingsMenu,ArlimaJS),ArlimaArticleConnection=function(a,b,c,d){"use strict";var e=a(document),f={posts:{},currentPost:{},$fancybox:null,$elem:!1,$futureNotice:!1,article:!1,searchedPosts:{},isPublishedPost:!1,setup:function(b){this.article=b,this.isPublishedPost=b.isPublished();var c=[];b.data.post&&c.push(b.data.post),a.each(b.getChildArticles(),function(a,b){b.data.post&&c.push(b.data.post)}),0==c.length||1==c.length&&0==c[0]?(this.posts={},this.currentPost={},this.setupLinks()):g(c)?(this.currentPost=this.posts[b.data.post]||{},this.setupLinks()):d.getPost(c.join(","),function(a){if(!a.posts)throw new Error("Backend did not return a list of posts ("+c.join(",")+")");f.posts=a.posts,f.currentPost=a.posts[b.data.post]||{},f.setupLinks(),e.trigger("postLoaded",[a.posts])})},getConnectionLabel:function(){return this.currentPost.ID?this.currentPost.post_title:this.article.opt("overridingURL")},setupLinks:function(){var a=this.currentPost.ID?this.currentPost.url:this.article.opt("overridingURL"),c=this.getConnectionLabel();this.$fancybox.find(".connection").text(c),this.$elem.find(".url").attr("href",a).text(c),this.currentPost.ID?(this.$elem.find(".wp-admin-edit").show(),this.$fancybox.find(".overriding-url").val(""),this.$fancybox.find(".container").hide().filter(".wp-post").show(),this.$fancybox.find(".button").removeClass("active").filter(".wp-post-btn").addClass("active")):(this.$fancybox.find(".overriding-url").val(a),this.$fancybox.find(".container").hide().filter(".overriding-url").show(),this.$fancybox.find(".button").removeClass("active").filter(".overriding-url-btn").addClass("active"),b.selectVal(this.$fancybox.find("select.target"),this.article.opt("target")||"")),this.isPublishedPost?this.$futureNotice.hide():this.$futureNotice.show()},init:function(d,g){this.$elem=d,this.$futureNotice=d.find(".future-notice").hide(),this.$fancybox=g,d.find(".url").click(function(){return""!=this.href&&"#"!=this.href&&window.open(this.href),!1}),d.find(".change").click(function(){return a.fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:500,speedOut:300,autoDimensions:!0,centerOnScroll:!0,href:"#article-connection"}),!1}),d.find(".wp-admin-edit").click(function(){return(c.article||c.article.data.post)&&window.open("post.php?post="+c.article.data.post+"&action=edit"),!1}),this.$fancybox.find(".button").click(function(){var d=a(this);if(d.hasClass("save")){var g=f.$fancybox.find("input.overriding-url").val(),h=f.$fancybox.find("select.target").val();g!=c.$form.find("input.overriding-url").val()&&(f.currentPost={},c.change("input.post",""),c.change("input.overriding-url",g),f.$fancybox.find(".connection").text(g),f.article.data.published=Math.round((new Date).getTime()/1e3-10),f.$futureNotice.hide(),f.article.data.image&&f.article.data.image.connected&&delete f.article.data.image.connected,f.article.updateTitleElement(!0)),c.$form.find("input.overriding-url-target").val()!=h&&c.change("input.overriding-url-target",h),a(".fancybox-close").trigger("click"),f.$elem.find(".url").attr("href",g).text(g)}else if(d.hasClass("search-btn")){var i=a.trim(f.$fancybox.find("input.search").val());d.parent().css("opacity","0.5"),f.searchedPosts={},window.ArlimaBackend.queryPosts({search:i},function(g){d.parent().css("opacity","1");var h=f.$fancybox.find(".search-result");if(g.articles){var i="";a.each(g.articles,function(a,c){f.searchedPosts[c.post.ID]=c.post;var d=b.isFutureDate(1e3*c.data.published)?" <em>("+ArlimaJS.lang.future+")</em>":"";i+='<p><a href="#" data-post="'+c.data.post+'">'+c.post.post_title+"</a> "+d+"</p>"}),h.html(i),h.find("a").click(function(){var b=f.searchedPosts[a(this).attr("data-post")];return f.currentPost=b,f.posts[b.ID]=b,c.change("input.overriding-url",""),c.change("input.overriding-url-target",""),c.change("input.post",b.ID),f.$fancybox.find(".connection").text(b.post_title),f.$elem.find(".url").attr("href",b.url).text(b.post_title),f.article.data.published=b.published,f.article.updateTitleElement(!0),f.article.isPublished()?f.$futureNotice.hide():f.$futureNotice.show(),e.trigger("postLoaded",[f.posts]),a(".fancybox-close").trigger("click"),!1})}else h.html("<p>"+ArlimaJS.lang.nothingFound+"</p>")})}else d.hasClass("overriding-url-btn")?(d.siblings().removeClass("active"),d.addClass("active"),f.$fancybox.find(".container").hide().filter(".overriding-url").show()):d.hasClass("wp-post-btn")?(d.siblings().removeClass("active"),d.addClass("active"),f.$fancybox.find(".container").hide().filter(".wp-post").show()):b.log("Pushing button in fancybox that does not exist","error");return!1})}},g=function(b){var c=!0;return a.each(b,function(a,b){return b in f.posts?void 0:(c=!1,!1)}),c};return f}(jQuery,ArlimaUtils,ArlimaArticleForm,ArlimaBackend),ArlimaPostSearch=function(a,b,c,d,e){var f={$elem:!1,isSearching:!1,currentOffset:0,search:function(b){if(this.isSearching)return!1;void 0===b&&(b=0),this.currentOffset=b,g(this,!0);var h={offset:b};this.$elem.find("input,select").each(function(){this.name&&(this.type?"checkbox"==this.type&&a(this).is(":checked")?h[this.name]=this.value:"checkbox"!=this.type&&(h[this.name]=this.value):h[this.name]=a(this).val())});var i=this.$elem.find(".search-result"),j=i.find("tbody");return c.queryPosts(h,function(c){g(f,!1),c&&(j.html(""),i.show(),i.find(".previous").hide(),i.find(".next").hide(),0==c.articles.length?j.append('<tr><td colspan="3"><em>'+d.lang.noPostsFound+"...</em></td></tr>"):(a.each(c.articles,function(b,c){var f=e.isFutureDate(1e3*c.data.published)?" <em>("+d.lang.future+")</em>":"",g=a("<tr><td><div>"+c.post.post_title+f+"</div></td><td>"+c.post.display_author+"</td><td>"+c.post.post_date+"</td></tr>"),h=g.find("div").get(0);g.find("td").get(0).arlimaArticle=new ArlimaArticle(c.data),h.arlimaArticle=new ArlimaArticle(c.data),e.makeDraggable(a(h)),j.append(g)}),0==b?i.find(".previous").hide():i.find(".previous").show(),c.articles.length>=10&&i.find(".next").show()))}),!1},init:function(a){this.$elem=a,e.makeCollapsing(a),a.find("form").on("submit",function(){return f.search(0),!1}),a.find("tfoot .previous").on("click",function(){f.search(f.currentOffset-10)}),a.find("tfoot .next").on("click",function(){f.search(f.currentOffset+10)})}},g=function(a,b){a.isSearching=b,a.isSearching?(a.$elem.find(".ajax-loader").show(),a.$elem.find(".search-result").hide()):a.$elem.find(".ajax-loader").hide()};return f}(jQuery,window,ArlimaBackend,ArlimaJS,ArlimaUtils,ArlimaArticleForm),ArlimaListLoader=function(a,b,c){var d={load:function(a,b,d){var e;"object"==typeof a&&(e=a),c.loadListData(e?e.data.id:a,d||"",function(a){a&&a.exists?(e?(d&&(a.loadedVersion=a.version.id,a.version=e.data.version),e.setData(a)):e=new ArlimaList(a),e.setArticles(a.articles),b(e)):b(!1)})},save:function(a,b){c.saveList(a.data.id,a.getArticleData(),function(a){"function"==typeof b&&b(a)})},init:function(c){var f=c.find("select"),g=function(a){a&&(a in b.ArlimaListContainer.lists?ArlimaUtils.shake(b.ArlimaListContainer.lists[a]):d.load(a,function(a){b.ArlimaListContainer.add(a)}))};c.find(".action").click(function(){this.blur();f.val();g(f.val())}),e(c.find(".list-search input"),c.find(".list-search ul")),c.find(".list-search .list").on("click",function(){g(a(this).attr("data-alid"))})}};a.expr[":"].Contains=function(b,c,d){return a(b).text().toUpperCase().indexOf(d[3].toUpperCase())>=0};var e=function(b,c){return c.hide(),b.keyup(function(b){var d=b.keyCode?b.keyCode:b.which;"13"==d&&b.preventDefault();var e=a.trim(a(this).val());if(e.length>0){var f=c.children().filter(":Contains('"+e+"')").show().length;f&&(c.children().not(":Contains('"+e+"')").hide(),c.show())}else c.hide()}).blur(function(){setTimeout(function(){c.hide()},500)}).focus(function(){a(this).trigger("keyup")})};return d}(jQuery,window,ArlimaBackend,ArlimaJS),ArlimaFormBlocker=function(a,b,c){var d={$formBlocker:!1,$streamerBlocker:!1,$preTitleBlocker:!1,$titleSizeBlocker:!1,toggleFormBlocker:function(b,c){b?(c&&a('<div class="block-message">'+c+"</div>").appendTo(this.$formBlocker),this.$formBlocker.show(),d.updateFormBlockerSize(),setTimeout(function(){d.updateFormBlockerSize()},500)):(this.$formBlocker.hide(),this.$formBlocker.find(".block-message").remove())},updateFormBlockerSize:function(){this.$formBlocker.css({width:c.$form.parent().outerWidth()+20,height:c.$form.parent().outerHeight()+c.$controls.outerHeight()})},toggleStreamerBlocker:function(a){if(a){this.$streamerBlocker.show(),c.change(".streamer-type","",!1),c.change(".streamer.content","",!1);var b=c.$form.find(".button.streamer");b.hasClass("active")&&b.trigger("click")}else this.$streamerBlocker.hide()},toggleTitleBlocker:function(a){var b=c.$form.find("input.pre-title");a?(this.$preTitleBlocker.show().css("top",b.position().top+"px"),this.$titleSizeBlocker.show().css("top",b.position().top+"px"),b.attr("disabled","disabled").val("")):(this.$preTitleBlocker.hide(),this.$titleSizeBlocker.hide(),b.removeAttr("disabled"))},removeBlockers:function(){this.toggleStreamerBlocker(!1),this.toggleTitleBlocker(!1),this.toggleFormBlocker(!1),c.$form.find("input.pre-title").removeAttr("disabled")},addBlocker:function(a){switch(a){case"streamer":this.toggleStreamerBlocker(!0);break;case"title":this.toggleTitleBlocker(!0);break;default:return!1}return!0},init:function(){this.$formBlocker=a('<div class="form-blocker blocker"></div>').appendTo(c.$form),this.$streamerBlocker=a('<div class="streamer-blocker blocker"></div>').appendTo(c.$form),this.$preTitleBlocker=a('<div class="pre-title-blocker blocker"></div>').appendTo(c.$form),this.$titleSizeBlocker=a('<div class="title-size-blocker blocker"></div>').appendTo(c.$form),c.$form.bind("open",function(){if(d.$formBlocker.is(":visible"))d.updateFormBlockerSize();else if(d.$titleSizeBlocker.is(":visible")){var a=c.$form.find("input.pre-title");d.$preTitleBlocker.show().css("top",a.position().top+"px"),d.$titleSizeBlocker.show().css("top",a.position().top+"px")}}),a(b).bind("arlimaFormImageLoaded",function(){d.$formBlocker.is(":visible")&&d.updateFormBlockerSize()})}};return d}(jQuery,window,ArlimaArticleForm),ArlimaTemplateLoader=function(a){"use strict";var b=function(a){return"/"==a.substr(a.length-1,1)&&(a=a.substr(0,a.length-1)),a.substr(0,a.lastIndexOf("/"))};return{isRequestingTemplate:!1,finishedLoading:!1,templates:{},_templateSupport:{},_templatesToLoad:[],_templateParts:{},load:function(a){this.finishedLoading=!1,this._templatesToLoad=a,this._loadNextTemplate()},templateSupport:function(a,b){return b?void 0===this._templateSupport[a]?void 0:this._templateSupport[a][b]:this._templateSupport[a]},getTemplateSupport:function(a){return this.templateSupport(a.getTemplate())||{}},_loadNextTemplate:function(){var b=this;if(this.isRequestingTemplate)setTimeout(function(){b._loadNextTemplate()},200);else if(this._templatesToLoad.length>0){var c=this._templatesToLoad.splice(0,1)[0];3==c.length&&(c=c[1]),this._loadTemplate(c,function(d,e){b._templateParts[c]=d,a.each(b._parseIncludes(d,e),function(a,c){b._templatesToLoad.push(c)}),b._loadNextTemplate()})}else this._buildTemplates(),this.finishedLoading=!0},_parseIncludes:function(b,c){var d=b.match(/\{\{include [0-9a-z\/A-Z\-\_\.]*\}\}/g);if(d){var e=this;return a.each(d,function(a,b){var f=b.replace("{{include ","").replace("}}","");d[a]=[b,e._makeTemplateURL(c,f),c]}),d}return[]},_makeTemplateURL:function(b,c){var d=b+c;if(d.indexOf("../")>-1){var e=d.substr(d.indexOf("://")+3).split("/"),f=[];return a.each(e,function(a,b){".."==b?f.splice(-1):f.push(b)}),d.substr(0,d.indexOf("://"))+"://"+f.join("/")}return d},_buildTemplates:function(){var b=this;a.each(this._templateParts,function(a,c){var d=b.extractFileNameFromURL(a),e=a.substr(0,a.lastIndexOf("/"))+"/";b.templates[d]=c;for(var f=b._parseIncludes(b.templates[d],e);f&&f.length>0;){for(var g=0;g<f.length;g++)b.templates[d]=b.templates[d].replace(f[g][0],b._templateParts[f[g][1]]);f=b._parseIncludes(b.templates[d],e)}}),a.each(this.templates,function(c,d){var e={},f=d.match(new RegExp("({{image-support .*}})","g"));if(f&&f[0]){b.templates[c]=d.replace(new RegExp("({{image-support .*}})","g"),"");var g=a.trim(f[0].substr(f[0].indexOf(" ")).replace("}}",""));e.imageSize={},a.each(a("<div "+g+"></div>").get(0).attributes,function(a,b){g.indexOf(b.name)>-1&&(e.imageSize[b.name]=b.value)})}e.image=d.indexOf("{{image.url}}")>-1||d.indexOf("{{{html_image}}}")>-1,e.streamer=d.indexOf("{{html_streamer}}")>-1,e.editor=d.indexOf("{{html_content}}")>-1||d.indexOf("{{content}}")>-1,e.title=d.indexOf("{{html_title}}")>-1,b._templateSupport[c]=e}),delete this._templateParts},extractFileNameFromURL:function(a){var b=a.substr(a.lastIndexOf("/")+1,a.length);return b.substr(0,b.indexOf("."))},_loadTemplate:function(c,d){this.isRequestingTemplate=!0;var e=this;a.ajax({dataType:"text",url:c,success:function(a){e.isRequestingTemplate=!1,d(a,b(c)+"/")},error:function(){ArlimaUtils.log("Unable to load template "+c,"error"),e.isRequestingTemplate=!1,d("<!-- ! Missing template "+c+" -->",b(c)+"/")}})}}}(jQuery),ArlimaVersionManager=function(a,b){var c={versions:!1,versionsInFront:!1,setArticle:function(a){this.clear(),this.addVersion(a)},addVersion:function(a){this.versions.push(JSON.stringify(a.data)),this.versions.length>50&&this.versions.splice(0,1)},stepBack:function(){this.versions.length>1&&(this.versionsInFront.push(this.versions.splice(-1)),d())},stepForward:function(){this.versionsInFront.length>0&&(this.versions.push(this.versionsInFront.splice(-1)),d())},clear:function(){this.versions=[],this.versionsInFront=[]}},d=function(){b.article.setData(JSON.parse(c.versions[c.versions.length-1])),b.setupForm(),b.toggleUnsavedState("unsaved")};return c}(jQuery,ArlimaArticleForm),ArlimaListContainer=function(a,b,c,d,e,f){"use strict";return{lists:{},$elem:null,lastTouchedList:null,add:function(a,b){b||(b={left:"5px",top:"5px",width:"300px",height:"400px"}),this.$elem.append(a.$elem),a.$elem.css(b),this.lists[a.data.id.toString()]=a,a.$elem.trigger("addedToContainer");var c=this;a.$elem.bind("change click dragged resized",function(){c.lastTouchedList=a.data.id})},remove:function(c,d){"object"!=typeof c&&(c=this.list(c)),b.ArlimaArticleForm.isEditing(c.data.id)&&b.ArlimaArticleForm.clear();var g=!0;c.hasUnsavedChanges()&&!f.hasMetaKeyPressed(d)&&(g=confirm(e.lang.changesBeforeRemove)),g&&(c.$elem.trigger("removedFromContainer"),c.$elem.fadeOut(function(){a(this).remove()}),delete this.lists[c.data.id.toString()])},saveListSetup:function(b){var d=[];a.each(this.lists,function(a,b){var c=b.$elem.position();d.push({alid:a,top:c.top,left:c.left,width:b.$elem.width(),height:b.$elem.height()})}),c.saveListSetup(d,function(){"function"==typeof b&&b()})},loadListSetup:function(e){c.loadListSetup(function(c){if(c){var f=c.length;if(0==f)e();else{var g=function(a,c){d.load(a,function(a){a&&b.ArlimaListContainer.add(a,c),f--,0==f&&e()})};a.each(c,function(a,b){g(b.alid,{top:parseInt(b.top,10),left:parseInt(b.left,10),height:parseInt(b.height,10),width:parseInt(b.width,10)})})}}else e()})},showAsActive:function(b){a.each(this.lists,function(a,b){return b.$elem.hasClass("active")?(b.$elem.removeClass("active"),!1):void 0}),b&&!this.list(b).data.isImported&&this.list(b).$elem.addClass("active")},list:function(a){return"object"==typeof a&&"listID"in a?this.lists[a.listID]:this.lists[a]},init:function(b,c){this.$elem=b;var d=this;b.find(".ajax-loader").show(),this.loadListSetup(function(){b.find(".ajax-loader").hide()}),c.find(".refresh-lists").on("click",function(b){var c=!1;a.each(d.lists,function(a,b){return b.hasUnsavedChanges()?(c=!0,!1):void 0});var g=!0;return c&&!f.hasMetaKeyPressed(b)&&(g=confirm(e.lang.unsaved)),g&&a.each(d.lists,function(a,b){b.reload()}),!1}),c.find(".save").on("click",function(){c.find(".ajax-loader").show(),ArlimaListContainer.saveListSetup(function(){c.find(".ajax-loader").hide()})})}}}(jQuery,window,ArlimaBackend,ArlimaListLoader,ArlimaJS,ArlimaUtils),ArlimaKeyBoardShortCuts=function(a,b,c,d,e){"use strict";var f={p:{key:80,run:function(){e.article&&c.toggle()}},s:{key:83,run:function(){var a=b.ArlimaUtils.getUnsavedListInFocus();a&&a.save()}},l:{key:76,run:function(){var a=b.ArlimaUtils.getUnsavedListInFocus();a?a.preview():e.article&&b.ArlimaListContainer.list(e.article.listID).preview()}},y:{key:89,run:function(){e.article&&d.stepForward()}},z:{key:90,run:function(){e.article&&d.stepBack()}},getKeyList:function(b){var c=[];return b?a.each(b.split(""),function(a,b){c.push(f[b].key)}):a.each(this,function(a,b){"function"!=typeof b&&c.push(b.key)}),c},interpretCommand:function(b,c){var d=b.keyCode||b.which;return(b.ctrlKey||b.metaKey)&&a.inArray(d,c)>-1?d:!1}};return{init:function(){var c=f.getKeyList("plszy"),d=f.getKeyList("pls");a(document).bind("keydown",function(a){var b=f.interpretCommand(a,c);if(b){switch(b){case f.p.key:f.p.run();break;case f.s.key:f.s.run();break;case f.l.key:f.l.run();break;case f.y.key:if(a.target&&"INPUT"==a.target.nodeName)return!0;f.y.run();break;case f.z.key:if(a.target&&"INPUT"==a.target.nodeName)return!0;a.shiftKey?f.y.run():f.z.run()}return a.preventDefault(),!1}});var e=setInterval(function(){void 0!==b.tinyMCE&&(clearInterval(e),b.tinyMCE.editors&&b.tinyMCE.editors.length>0&&b.tinyMCE.editors[0].onKeyDown.add(function(a,c){var e=c.keyCode||c.which;if(32==e||190==e)b.arlimaTinyMCEChanged();else if(e=f.interpretCommand(c,d)){switch(e){case f.p.key:f.p.run();break;case f.s.key:f.s.run();break;case f.l.key:f.l.run()}return c.preventDefault(),!1}}))},500)}}}(jQuery,window,ArlimaArticlePreview,ArlimaVersionManager,ArlimaArticleForm),ArlimaListPreview=function(a,b,c,d){var e=a(b),f={list:null,previewWindow:!1,preview:function(a){if(!a.data.previewURL)return alert(ArlimaJS.lang.missingPreviewPage),void 0;if(!a.hasUnsavedChanges()){var e=i(a.data.previewURL,"yes");return h(g(e)),void 0}a.toggleAjaxPreLoader(!0),this.list=a,this.previewWindow&&this.previewWindow.close(),b.ArlimaBackend.savePreview(a.data.id,a.getArticleData(),function(e){if(f.list.toggleAjaxPreLoader(!1),e){var k=i(a.data.previewURL,a.data.id);f.previewWindow=g(k,function(a){if(j(a("body")),a(f.previewWindow.document).keydown(function(a){var d=a.keyCode?a.keyCode:a.which;return 83==d&&c.hasMetaKeyPressed(a)?(f.list.save(),f.previewWindow.close(),b.focus(),f.previewWindow=!1,a.preventDefault(),!1):void 0}),d.currentPost&&d.currentPost.ID){var e=a("*[data-post='"+d.currentPost.ID+"']").first();e.length>0&&a(f.previewWindow).scrollTop(e.position().top-80)}}),h(f.previewWindow)}})}},g=function(a,c){var d="arlima"+(new Date).getTime(),e=b.open(a,d,"toolbar=1,scrollbars=1,width=10,height=10");if(e)var f=setInterval(function(){e.jQuery&&(clearInterval(f),e.jQuery(function(a){a("body").css("margin-top","-32px"),a("#wpadminbar").remove(),"function"==typeof c&&c(a)}))},300);else alert("Your browser has blocked the pop-up window!");return e},h=function(a){a&&(a.resizeTo(e.width(),e.height()),a.focus())},i=function(a,c){return a+(a.indexOf("?")>-1?"&":"?")+b.ArlimaJS.previewQueryArg+"="+c},j=function(c){var d=a("<div></div>");d.css({position:"fixed",top:"20px",left:"0",width:"100%",zIndex:"9999"}).appendTo(c);var e=-1==b.navigator.userAgent.indexOf("Mac")?"ctrl":"cmd";a("<div></div>").text(e+" + s "+b.ArlimaJS.lang.savePreview+' "'+f.list.data.title+'"').css({background:"#222",backgroundColor:"rgba(0,0,0, .85)",fontSize:"13px",color:"#FFF",margin:"16px",padding:"10px",webkitborderRadius:"12px",mozBorderRadius:"13px",borderRadius:"12px",fontWeight:"bold",webkitBoxShadow:"0 0 7px #333",mozBoxShadow:"0 0 7px #333",boxShadow:"0 0 7px #333"}).appendTo(d)};return f}(jQuery,window,ArlimaUtils,ArlimaArticleConnection),ArlimaImageManager=function(a,b,c,d){"use strict";var e={$elem:!1,$imageWrapper:!1,$sizeOpts:!1,$buttons:!1,$selects:!1,article:!1,setup:function(a){this.article=a,g()},removeImage:function(){this.article.data.image={},c.change(".image-attach",""),g()},setNewImage:function(a,b,d,f,h){e.article.data.image={size:f||"full",url:a,alignment:h||"alignleft",attachment:b},d&&(e.article.data.image.connected=1),c.change(".image-attach",b),g()},init:function(d){this.$elem=d,this.$imageWrapper=d.find(".image"),this.$buttons=d.find(".button"),this.$selects=d.find("select"),this.$sizeOpts=e.$selects.filter(".img-size").find("option");var f=d.find(".attachments-fancybox");b.ArlimaJS.hasScissors?ArlimaScissors.init(this.$buttons.filter(".scissors")):this.$buttons.filter(".scissors").remove(),this.$buttons.filter(".remove").click(function(){return e.removeImage(),!1}),this.$buttons.filter(".browse").click(function(){return b.wpMediaModal?(b.wpMediaModal.open(),void 0):(b.wpMediaModal=wp.media.frames.file_frame=wp.media({title:"a title",button:{text:b.ArlimaJS.insertImage},multiple:!1}),b.wpMediaModal.on("select",function(){var a=b.wpMediaModal.state().get("selection").first().toJSON();e.setNewImage(a.url,a.id)}),b.wpMediaModal.open(),!1)}),this.$buttons.filter(".disconnect").click(function(){return a(this).hide(),e.article.data.image.connected="",c.$form.find(".image-attach").trigger("change"),ArlimaBackend.duplicateImage(e.article.data.image.attachment,function(){}),!1}),this.$imageWrapper.click(function(){return e.article&&parseInt(e.article.data.post,10)&&b.ArlimaBackend.getPostAttachments(e.article.data.post,function(b){f.html(""),a.each(b,function(b,c){a("<div></div>").addClass("arlima-article-attachment").html(c.thumb).on("click",function(){e.setNewImage(c.url[0],c.attachment,!0),a(".fancybox-close").trigger("click")}).appendTo(f)}),a.fancybox({minHeight:200,href:"#arlima-article-attachments"})}),!1})}},f=function(c){if(c){var d=a('<img src="'+e.article.data.image.url+'" />');d.load(function(){a(b).trigger("arlimaFormImageLoaded")}),e.$imageWrapper.html(d).removeClass("no-image")}else e.$imageWrapper.hasClass("no-image")||e.$imageWrapper.html('<i class="fa fa-camera-retro fa-5x"></i>').addClass("no-image")
},g=function(){if(e.article.data.image&&e.article.data.image.url){f(!0),e.$buttons.show(),e.$selects.show();var b=d.getTemplateSupport(e.article).imageSize,c=!1;if(b){if(e.article.isChild()&&b["children-size"]?c=b["children-size"].split(","):b.size&&(c=b.size.split(",")),c){e.$sizeOpts.attr("disabled","disabled");var g=!1;a.each(c,function(b,c){c=a.trim(c),e.$sizeOpts.filter('[value="'+c+'"]').removeAttr("disabled"),c==e.article.data.image.size&&(g=!0)}),g||(e.article.data.image.size=e.$sizeOpts.filter(":not(disabled)").attr("value"))}}else e.$sizeOpts.removeAttr("disabled");ArlimaUtils.selectVal(e.$selects.filter(".img-align"),e.article.data.image.alignment,!1),ArlimaUtils.selectVal(e.$selects.filter(".img-size"),e.article.data.image.size,!1),e.article.data.image.connected||e.$buttons.filter(".disconnect").hide()}else f(!1),e.$buttons.filter(":not(.browse)").hide(),e.$selects.hide()};return e}(jQuery,window,ArlimaArticleForm,ArlimaTemplateLoader),ArlimaImageUploader=function(a,b,c,d,e){"use strict";var f=["jpeg","jpg","gif","png"],g=5,h={$notifyElement:!1,$mainUploadElement:!1,showPreloader:function(){var a='<i class="fa fa-cog fa-spin large fa-5x"></i>';this.$mainUploadElement.find("img").css("opacity","0.75"),this.$notifyElement?this.$notifyElement.html(a):this.showNotice(a)},removeNotice:function(){this.$notifyElement&&(this.$mainUploadElement.find("img").css("opacity","1"),this.$notifyElement.fadeOut("slow",function(){a(this).remove()}),this.$notifyElement=!1)},showNotice:function(b){this.$notifyElement||(this.$notifyElement=a('<div class="file-progress"></div>'),this.$notifyElement.appendTo(this.$mainUploadElement)),0!==b.indexOf("<")&&(b="<p>"+b+"</p>"),this.$notifyElement.html("").append(b)},init:function(d,i){if("FileReader"in b){this.$mainUploadElement=d.find(".image");var j=new e.Uploader({runtimes:"html5,html4",drop_element:i,container:"fake-container",dragdrop:!0});j.bind("Init",function(){if(j.features.dragdrop){var b=a("#"+i);b[0].ondragover=function(a){a.dataTransfer.dropEffect="copy"},b[0].ondragenter=function(){b.addClass("dragover")},b[0].ondragleave=function(){b.removeClass("dragover")},b[0].ondrop=function(){b.removeClass("dragover")}}}),j.bind("FilesAdded",function(d,e){var i=!0;if(a.each(f,function(a,b){return e[0].native.type.toLowerCase().indexOf(b)>-1?(i=!1,!1):void 0}),i)return h.showNotice("File was not an image"),setTimeout(function(){h.removeNotice()},2e3),void 0;if(1024*g*1024<e[0].native.size)return h.showNotice("Image is to big (max "+g+" MB)"),setTimeout(function(){h.removeNotice()},2e3),void 0;var j=new b.FileReader;j.onloadend=function(){var a=j.result;0===a.indexOf("data:")&&(a=a.substr(a.indexOf(",")+1)),h.showPreloader(),b.ArlimaBackend.saveImage(a,c.article?c.article.post:"",e[0].native.name,function(a){h.removeNotice(),a&&ArlimaImageManager.setNewImage(a.url,a.attachment,c.article.data.post?!0:!1)})},j.onerror=function(a){var b="";switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:b="File not found!";break;case a.target.error.NOT_READABLE_ERR:b="File not readable!";break;case a.target.error.ABORT_ERR:b="Aborted";break;default:b="Unkown..."}h.showNotice(b)},j.readAsDataURL(e[0].native)}),j.init()}}};return h}(jQuery,window,ArlimaArticleForm,ArlimaJS,plupload),ArlimaFileIncludes=function(a,b,c,d,e){var f={$elem:!1,search:function(){this.$elem.find(".file-include").each(function(b,c){a(c).get(0).arlimaArticle=new ArlimaArticle({title:a(c).data("label"),options:{fileInclude:a(c).data("file")}}),a(c).draggable({appendTo:"body",helper:"clone",sender:"postlist",connectToSortable:".article-list .articles",revert:"invalid",start:function(a,b){b.helper.html('<div class="article-title-container"><span>'+b.helper.html()+"</span></div>"),b.helper.addClass("article"),b.helper.css("z-index","99999")}})})},init:function(a){this.$elem=a,e.makeCollapsing(a),this.search()}};return f}(jQuery,window,ArlimaBackend,ArlimaJS,ArlimaUtils,ArlimaArticleForm),ArlimaScissors=function(a,b,c,d,e){var f={init:function(g){var h=a("#image-scissors-popup"),i=!1,j=!1;g.fancybox({autoResize:1,fitToView:1,margin:new Array(40,0,0,0),speedIn:300,speedOut:300,titlePosition:"over",autoDimensions:!0,afterClose:function(){if(i){var a=e.$imageWrapper.find("img");a.attr("src",a.attr("src")+"?"+Math.random()),d.removeImageVersions(j.attachment),e.setNewImage(j.url.split("?")[0]+"?edited="+(new Date).getTime(),j.attachment,j.connected,j.size,j.alignment),b.ArlimaArticlePreview.isVisible()&&b.ArlimaArticlePreview.reload()}},beforeLoad:function(){j=c.article.data.image,i=!1,h.html('<div id="media-item-'+j.attachment+'">'+e.$imageWrapper.html()+"</div>"),h.find("img").addClass("thumbnail").css("max-width","200px"),d.loadScissorsHTML(j.attachment,function(a){a&&(h.append(a),h.find("#scissorsShowBtn-"+j.attachment+" button").click(function(){i=!0}))})}}),document.addEventListener("DOMNodeInserted",function(b){b.target&&b.target.id&&(0===b.target.id.indexOf("scissorsCrop")?f.modifyScissorsEditor(a(this)):0===b.target.id.indexOf("scissorsWatermark")&&f.modifyScissorsWatermarkEditor(a(this)))})},modifyScissorsEditor:function(b){var d=c.article.data.image.attachment;a.each(ArlimaJSAdmin.scissorsCropTemplates,function(a,b){g(a,b[0],b[1],d)}),b.find('input[type="checkbox"]').each(function(){this.id&&0==this.id.indexOf("scissorsLockBox")&&a(this).prop("checked",!1)}),b.find("div").each(function(){this.id&&0==this.id.indexOf("scissorsReir")&&a("#"+this.id).hide()})},modifyScissorsWatermarkEditor:function(b){b.find('input[type="checkbox"]').each(function(){if(this.id&&0==this.id.indexOf("scissors_watermark_target")){var b=this.id.split("_");void 0!==b[3]&&(b=b[3].split("-"),a(this).prop("checked",!0),scissorsWatermarkStateChanged(b[b.length-1],b[0]))}})}},g=function(b,c,d,e){a("<button></button>").html(b).addClass("button").appendTo("#scissorsCropPane-"+e).bind("click",function(){return a("#scissorsLockBox-"+e).prop("checked",!0),scissorsAspectChange(e),a("#scissorsLockX-"+e).val(c),a("#scissorsLockY-"+e).val(d),scissorsManualAspectChange(e),!1})};return f}(jQuery,window,ArlimaArticleForm,ArlimaBackend,ArlimaImageManager),ArlimaArticleTemplates=function(a,b,c,d){return{init:function(b){var e=b.find("tbody");d.makeCollapsing(b),c.loadCustomTemplateData(function(b){b&&a.each(b,function(b,c){var f=a("<tr><td><div>"+c.name+"</div></td></tr>");f.find("div").get(0).arlimaArticle=new ArlimaArticle(c),e.append(f),d.makeDraggable(f.find("div").eq(0))})})}}}(jQuery,window,ArlimaBackend,ArlimaUtils),ArlimaScheduledIntervalPicker=function(a,b,c){var d={$fancyBox:!1,open:function(){a.fancybox({href:"#scheduled-interval-fancybox",height:400,width:400,beforeLoad:function(){var b=c.article.opt("scheduledInterval");b||(b="*:*",c.change(".scheduled-interval",b,!0));var e=d.$fancyBox.find("input");e.removeAttr("checked"),a.each(b.split(":"),function(b,c){if("*"==a.trim(c)){var d=0==b?".day":".hour";e.filter(d).attr("checked","checked")}else a.each(c.split(","),function(a,b){e.filter('[value="'+b+'"]').attr("checked","checked")})})},afterClose:function(){var a=function(a){var b="*",c=d.$fancyBox.find("."+a);return c.filter(":checked").length!=c.length&&(b="",c.filter(":checked").each(function(){b+=","+this.value}),b=""==b?"*":b.substr(1)),b},b=a("day")+":"+a("hour");b!=c.article.opt("scheduledInterval")&&c.change(".scheduled-interval",b,!0)}})},removePickedInterval:function(){c.change(".scheduled-interval","",!0)},init:function(b){for(var c=b.find(".hours").children().eq(0),d=1;25>d;d++){var e=10>d?"0"+d:d,f=d%8===0?"<br />":"";a('<label><input type="checkbox" class="hour" value="'+e+'" /> '+e+"</label>"+f).insertBefore(c)}b.find(".toggler").click(function(){var b=a(this).parent().parent().find("input");return b.filter(":checked").length?b.removeAttr("checked"):b.attr("checked","checked"),!1}),this.$fancyBox=b}};return d}(jQuery,window,ArlimaArticleForm);